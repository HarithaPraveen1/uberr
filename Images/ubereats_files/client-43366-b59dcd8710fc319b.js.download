"use strict";(self.webpackChunkFusion=self.webpackChunkFusion||[]).push([[43366],{65869:(e,s,n)=>{n.d(s,{Z:()=>u});var t=n(11183),l=n(28398),i=n(17589),r=n(66149),o=n(8070);function u(){const e=(0,t.I0)(),{selectedVoucherUUID:s}=(0,l.v)((e=>{let{checkout:s}=e;return s}))||{},{data:n}=(0,i.t)(),{vouchers:u}=n||{};return function(e,s){const n=(0,r.ab)(e);if(e&&n)return{voucherData:e,voucherUUID:null==e?void 0:e.uuid};e&&!n&&s();return{voucherData:null,voucherUUID:null}}(s&&u?u[s]:null,(()=>e((0,o.rj)())))}},43366:(e,s,n)=>{n.d(s,{Pk:()=>b,ZP:()=>k,IM:()=>F});var t=n(36151),l=n(19832),i=n(11183),r=n(28398),o=n(79026),u=n(78500),a=n(8070),d=n(92036),c=n(70736);var P=n(97117),f=n(71086),p=n(7903),y=n(21954),B=n(51301),m=n(58980),v=n(58793),h=n(72403),U=n(65869),C=n(19198),E=n(20034),x=n(14760);const D=(e,s)=>({profileUUID:null==e?void 0:e.uuid,profileType:null==e?void 0:e.type,policyUUID:null==s?void 0:s.uuid,policyVersion:null==s?void 0:s.version});var S=n(97174);const I=e=>{const{user:s}=(0,d.Z)(),n=(0,i.I0)(),{vouchersData:l}=(0,f.Z)(),{businessPolicies:I,businessProfiles:Z,getBusinessProfiles:g,onSelectBusinessProfile:b,selectedBusinessProfile:F,selectedBusinessPolicy:k,businessExpenseCodes:H,searchBusinessExpenseCodes:M,selectedBusinessExpenseCode:O,setSelectedBusinessExpenseCode:V,getBackUrl:G,handleBusinessBackButton:T,selectedBusinessExpenseMemo:w,setSelectedBusinessExpenseMemo:A,setSelectedBusinessPolicy:L,requiresProfileFlow:N,currentStep:q,getInitialUrl:R,confirmedProfileSelected:$,setConfirmedProfileSelected:z,getBusinessDetails:_,hasBusinessProfile:j}=(0,c.Z)(),{draftOrder:K}=(0,S.Dz)(),{selectedPersonalPayment:W,extraPaymentData:Y,paymentProfiles:J,creditBalances:Q,useCredits:X,updateSelectedPersonalPayment:ee,guestPaymentProfile:se,setGuestPaymentProfile:ne,guestPaymentProfileV2:te,setGuestPaymentProfileV2:le,useHealthcareBenefits:ie}=(0,P.Z)({businessProfiles:Z,draftOrder:K}),re=(0,r.v)((e=>e.checkout))||{},{selectedVoucherUUID:oe,selectedBusinessPayment:ue}=re,[ae,de]=function(e){let{initialPaymentIntent:s}=e;const[n,l]=(0,t.useState)(s);return[n,l]}({initialPaymentIntent:"personal"}),[ce,Pe]=t.useState(null);function fe(e){var s;if(de(e),"business"===e)return;const t=(null==l||null===(s=l.data)||void 0===s?void 0:s.vouchers)||{},i=oe&&t[oe];i&&n((0,a.wL)(i))}const{setSelectedBusinessExpenseCode:pe,setSelectedBusinessExpenseMemo:ye,isValidPaymentSwitch:Be,updateDraftOrderPaymentProfile:me,updateDraftOrderError:ve,setUseCreditsForManagedBusiness:he}=function(e){const s=(0,p.k6)(),n=(0,m.TH)(),l=(0,E.Z)(),r=(0,i.I0)(),a=(0,U.Z)(),d=(0,v.Ah)(l),{hasGroupOrder:c}=(0,y.Z)(),{updateDraftOrderV2:P,updateDraftOrderMaybe:f}=(0,B.Z)(),[S,I]=(0,t.useState)(!1),[Z,g]=(0,t.useState)(!1),b=Boolean(d),{groupOrder:F,getGroupOrder:k,shouldGetGroupOrder:H}=(0,C.Z)(d||"");(0,x.Z)((()=>H&&e.paymentIntent?k():null),[k,H,e],"use-business-draft-order");const M=(0,t.useCallback)((s=>{if(b&&!f.isLoading){const n=D(e.selectedBusinessProfile,e.selectedBusinessPolicy);P({draftOrderUUID:d||"",businessDetails:{...n,expenseCode:null==s?void 0:s.expenseCode}})}e.setSelectedBusinessExpenseCodeFn(s)}),[e,b,d,P,f]),O=(0,t.useCallback)((s=>{if(b&&!f.isLoading){var n;const t=D(e.selectedBusinessProfile,e.selectedBusinessPolicy);P({draftOrderUUID:d||"",businessDetails:{...t,expenseCode:null===(n=e.selectedBusinessExpenseCode)||void 0===n?void 0:n.expenseCode,expenseMemo:s}})}e.setSelectedBusinessExpenseMemoFn(s)}),[e,b,d,P,f]),V=(0,t.useCallback)((s=>{if(!b||!F.data)return null;var n,t,l;I(!1),s&&s.profileType===o.Hu.Business&&(delete s.voucherPolicyVersion,delete s.voucherUUID),s&&s.profileType===o.Hu.Personal&&null!=a&&a.voucherUUID&&(s.voucherPolicyVersion=null==a||null===(n=a.voucherData)||void 0===n||null===(t=n.policy)||void 0===t?void 0:t.version,s.voucherUUID=null==a?void 0:a.voucherUUID),r((0,u.GA)(s)),(null==s?void 0:s.profileType)===o.Hu.Personal&&null!==(l=e.selectedBusinessPolicy)&&void 0!==l&&l.isExpenseCodeRequired&&(e.setSelectedBusinessExpenseCodeFn(null),e.setSelectedBusinessExpenseMemoFn(null))}),[b,F.data,a,d,r,P,e.selectedBusinessProfile,e.selectedBusinessPolicy,e.selectedPersonalPayment]);return(0,t.useEffect)((()=>{var s;if(F.data&&("business"===e.paymentIntent&&e.selectedBusinessPolicy||(null===(s=e.selectedPersonalPayment)||void 0===s?void 0:s.type)===o.Hu.ManagedFamily)&&b){var n,t,l,i,a;const s={profileUUID:null===(n=e.selectedBusinessProfile)||void 0===n?void 0:n.uuid,profileType:null===(t=e.selectedBusinessProfile)||void 0===t?void 0:t.type,policyUUID:null===(l=e.selectedBusinessPolicy)||void 0===l?void 0:l.uuid,policyVersion:null===(i=e.selectedBusinessPolicy)||void 0===i?void 0:i.version};var d,c;I(!1),(null===(a=e.selectedPersonalPayment)||void 0===a?void 0:a.type)===o.Hu.ManagedFamily&&"personal"===e.paymentIntent&&(s.profileUUID=e.selectedPersonalPayment.uuid,s.profileType=o.Hu.ManagedFamily,r((0,u.Nc)(null===(d=e.selectedPersonalPayment)||void 0===d?void 0:d.defaultPaymentProfileUuid))),r((0,u.GA)(s)),r((0,u.eL)(Z)),(null==s?void 0:s.profileType)!==o.Hu.Personal&&(null==s?void 0:s.profileType)!==o.Hu.ManagedFamily&&r((0,u.Nc)(null===(c=e.selectedBusinessProfile)||void 0===c?void 0:c.defaultPaymentProfileUuid))}}),[F,d,P,e.paymentIntent,e.selectedBusinessPolicy,e.selectedBusinessProfile,e.selectedPersonalPayment,b,I,c,r,Z]),(0,t.useEffect)((()=>{const e=(0,h.vN_)(n,"updateDraftOrderError");!S&&f.hasLoaded&&f.error&&(I(!0),s.replace(e))}),[f,I,S,s,n]),(0,t.useEffect)((()=>{var e;!S&&(null==n?void 0:n.search)!==(null===(e=(0,h.vN_)(n,"updateDraftOrderError"))||void 0===e?void 0:e.search)||!f.hasLoaded||f.error||(I(!1),s.replace((0,h.Zs0)(n)))}),[f,I,S,s,n]),{setSelectedBusinessExpenseCode:M,setSelectedBusinessExpenseMemo:O,isValidPaymentSwitch:e=>e===o.Hu.Personal||e===o.Hu.Business,updateDraftOrderPaymentProfile:V,setUseCreditsForManagedBusiness:g,updateDraftOrderError:f.error}}({selectedBusinessPayment:ue,selectedBusinessProfile:F,selectedBusinessPolicy:k,selectedBusinessExpenseCode:O,selectedBusinessExpenseMemo:w,setSelectedBusinessExpenseCodeFn:V,setSelectedBusinessExpenseMemoFn:A,setPaymentIntent:fe,paymentIntent:ae,businessProfiles:Z,selectedPersonalPayment:W});return e.children({businessPolicies:I,businessProfiles:Z,getBusinessProfiles:g,onSelectBusinessProfile:b,selectedBusinessProfile:F,selectedBusinessPolicy:k,setSelectedBusinessPolicy:L,businessExpenseCodes:H,searchBusinessExpenseCodes:M,selectedBusinessExpenseCode:O,setSelectedBusinessExpenseCode:pe,getBackUrl:G,handleBusinessBackButton:T,selectedBusinessExpenseMemo:w,setSelectedBusinessExpenseMemo:ye,requiresProfileFlow:N,selectedBusinessPayment:ue,currentStep:q,hasBusinessProfile:j,selectedPersonalPayment:W,extraPaymentData:Y,paymentProfiles:J,creditBalances:Q,paymentIntent:ae,setPaymentIntent:fe,getInitialUrl:R,confirmedProfileSelected:$,setConfirmedProfileSelected:z,useCredits:null!=X?X:Q.length>0,user:s,updateSelectedPersonalPayment:ee,updateSelectedBusinessPayment:e=>{L(null),n((0,a.Kz)(e)),(null==e?void 0:e.profileType)===o.Hu.Business&&n((0,u.Nc)(null==e?void 0:e.paymentProfileUuid))},updateExtraPaymentData:e=>{n((0,a.n2)(e))},updateUseCredits:(e,s)=>{s===o.Hu.Personal?n((0,a.Pe)(e)):s===o.Hu.Business?n((0,a.sg)(e)):he(e)},isValidPaymentSwitch:Be,getBusinessDetails:_,updateDraftOrderPaymentProfile:me,updateDraftOrderError:ve,guestPaymentProfile:se,setGuestPaymentProfile:ne,guestPaymentProfileV2:te,setGuestPaymentProfileV2:le,paymentProfileInfoForCheckoutActions:ce,setPaymentProfileInfoForCheckoutActions:Pe,useHealthcareBenefits:ie,updateUseHealthcareBenefits:(e,s)=>{s===o.Hu.Personal?n((0,a.R$)(ie)):(o.Hu.Business,n((0,a.R$)(!1)))}})};var Z=n(24172),g=n(33990);const b=t.createContext({businessPolicies:o.TW,businessProfiles:null,getBusinessProfiles:l.Z,selectedBusinessProfile:null,selectedBusinessPolicy:null,setSelectedBusinessPolicy:l.Z,onSelectBusinessProfile:l.Z,businessExpenseCodes:o.$C,searchBusinessExpenseCodes:()=>{},selectedBusinessExpenseCode:null,setSelectedBusinessExpenseCode:l.Z,selectedBusinessExpenseMemo:null,setSelectedBusinessExpenseMemo:l.Z,getBackUrl:()=>({}),handleBusinessBackButton:l.Z,requiresProfileFlow:()=>!1,creditBalances:[],extraPaymentData:null,paymentProfiles:[],updateExtraPaymentData:l.Z,updateSelectedBusinessPayment:l.Z,updateUseCredits:l.Z,useCredits:!1,user:Z.V,paymentIntent:"personal",setPaymentIntent:l.Z,updateSelectedPersonalPayment:l.Z,selectedPersonalPayment:null,selectedBusinessPayment:null,currentStep:"PROFILE",getInitialUrl:()=>({}),confirmedProfileSelected:!1,setConfirmedProfileSelected:l.Z,isValidPaymentSwitch:()=>!1,getBusinessDetails:()=>({profileUUID:null,profileType:null,policyUUID:null,policyVersion:null}),updateDraftOrderPaymentProfile:()=>null,updateDraftOrderError:null,hasBusinessProfile:!1,guestPaymentProfile:null,setGuestPaymentProfile:l.Z,guestPaymentProfileV2:null,setGuestPaymentProfileV2:l.Z,paymentProfileInfoForCheckoutActions:null,setPaymentProfileInfoForCheckoutActions:l.Z,useHealthcareBenefits:!1,updateUseHealthcareBenefits:l.Z}),F=()=>{const e=t.useContext(b);if(null!==e)return e;throw Error("You should use useEditPaymentProfilesContext only in a descendant of EditPaymentProfilesProvider")};function k(e){return(0,g.tZ)(I,{children:s=>(0,g.tZ)(b.Provider,{value:s,children:e.children})})}}}]);