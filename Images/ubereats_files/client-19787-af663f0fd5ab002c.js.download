(self.webpackChunkFusion=self.webpackChunkFusion||[]).push([[19787],{48643:(e,s,n)=>{"use strict";n.d(s,{DC:()=>g,Eb:()=>m,FY:()=>B,Nj:()=>c,XC:()=>f,b6:()=>v,b_:()=>y,dR:()=>p,eY:()=>h,jm:()=>b,og:()=>C,oz:()=>P,rW:()=>x});var a=n(70300),i=n(79026),t=n(72035),l=n(84684),o=n(72403),u=n(33990);function d(e){return!e||e.type===i.Hu.Personal}function r(e){return e.map((e=>e.amountString)).join(", ")}function c(e){var s;if(!e)return null;const n={text:"",displayable:null};switch((e.tokenType||"").toLowerCase()){case"uber_test":case"derivative":case"paytm":n.text=e.cardType||"";break;case"paypal":n.displayable=(0,u.tZ)(a.v,{id:"shared.paypal"});break;case"cash":n.displayable=(0,u.tZ)(a.v,{id:"shared.cash"});break;case"stored_value":n.displayable=(0,u.tZ)(a.v,{id:"shared.uber_cash"});break;case"upi":n.displayable=(0,u.tZ)(a.v,{id:"shared.upi"});break;case"paypay":n.displayable=(0,u.tZ)(a.v,{id:"shared.paypay"});break;case"venmo":n.displayable=(0,u.tZ)(a.v,{id:"shared.venmo"});break;case"braintree":case"zaakpay":case"bancontact":n.text=function(e){const{cardType:s,cardNumber:n}=e,a=s?"".concat(s," - "):"•••• ";return"".concat(a).concat(n||"")}(e);break;case"apple_pay_display":n.text="Apple Pay";break;case"UBER_PAY":n.text=e.tokenDisplayName||(null===(s=e.displayable)||void 0===s?void 0:s.displayName)||e.accountName||"";break;default:n.text=e.accountName||""}return n}const p=(e,s,n)=>{var i,t,o;if(!e)return null;const d=(0,u.tZ)("div",{children:null==e?void 0:e.name});if(!(null!=e&&null!==(i=e.components)&&void 0!==i&&i.periodicCapComponent||null!=e&&null!==(t=e.components)&&void 0!==t&&t.perTripCapComponent))return{displayable:n?(0,u.tZ)("div",{children:e.description}):(0,u.tZ)(a.v,{id:"checkout.business_payments_balance.billed_to_company"}),text:""};if(null!==(o=e.components)&&void 0!==o&&o.periodicCapComponent){var r;const{amount:n,usage:i,currencyCode:t}=(null===(r=e.validationExtra)||void 0===r?void 0:r.periodicCapBalance)||{},o="number"==typeof n&&"number"==typeof i?(0,l.xG)(s,t||"",100*(n-i)):null;var c,p;if(o)return{displayable:{DAILY:(0,u.tZ)(a.v,{id:"checkout.business_payments_balance.daily",data:{balance:o}}),WEEKLY:(0,u.tZ)(a.v,{id:"checkout.business_payments_balance.weekly",data:{balance:o}}),MONTHLY:(0,u.tZ)(a.v,{id:"checkout.business_payments_balance.monthly",data:{balance:o}}),DEFAULT:d}[(null===(c=e.components)||void 0===c||null===(p=c.periodicCapComponent)||void 0===p?void 0:p.period)||"DEFAULT"],text:""}}else{var y;const{amount:n,currencyCode:i}=(null===(y=e.validationExtra)||void 0===y?void 0:y.perTripCapBalance)||{},t="number"!=typeof n?"":(0,l.xG)(s,i||"",100*n);if(t)return{displayable:(0,u.tZ)(a.v,{id:"checkout.business_payments_balance.per_order",data:{balance:t}}),text:""}}return{displayable:d,text:""}};function y(e){var s,n,a,i;return"ManagedBusiness"===(null==e?void 0:e.type)&&(null==e||null===(s=e.managedBusinessProfileAttributes)||void 0===s||null===(n=s.theme)||void 0===n||null===(a=n.logos)||void 0===a||null===(i=a.Large)||void 0===i?void 0:i.url)||""}function f(e,s){return e.find((e=>e.type===i.Hu.Personal&&e.defaultPaymentProfileUuid===s))}function v(e,s){const n=e.find((e=>e.uuid===s));return d(n)?null:n}function m(e){let{profile:s,paymentProfile:n,useCredits:t,paymentProfiles:l,creditBalances:o,selectedBusinessPolicy:y,selectedBusinessExpenseCode:f,selectedBusinessExpenseMemo:v,hasBusinessProfiles:m,errorActions:P,showCheckoutErrors:b,secondaryPaymentSelectionRequired:g,localeCode:C,shouldShowSecondaryPaymentSelection:h,useHealthcareBenefits:x,healthcareBenefitsPaymentProfile:B,isHealthcareCardExperiment:E}=e,_={text:"",displayable:null};const Z={payment:[],mealProgram:null,expenseCode:null},U={message:{text:"",displayable:null},action:null},S=c(n),k={text:"",displayable:(0,u.tZ)(a.v,{id:"shared.uber_cash_with_balance",data:{balance:r(o)}})};if(m)if(d(s)){if(_.displayable=(0,u.tZ)(a.v,{id:"components.payments_cell.personal"}),E&&Boolean(B)&&x){const e=c(B);e&&(Z.payment.push(e),S&&Z.payment.push(S))}else t&&Z.payment.push(k),S&&Z.payment.push(S);n||(U.message.displayable=(0,u.tZ)(a.v,{id:"shared.addPaymentMethod"}),U.action=P.getPaymentSelectAction())}else{if(_.text=(null==s?void 0:s.name)||"",_.displayable=(0,u.tZ)(a.v,{id:"components.payments_cell.business"}),null!=s&&s.isMealProgramRequired){if(null!=y&&y.isExpenseMemoRequired&&b&&(v||(U.message.displayable=(0,u.tZ)(a.v,{id:"shared.add_expense_memo"}),U.action=P.getAddExpenseMemoAction((null==s?void 0:s.uuid)||"",(null==y?void 0:y.uuid)||""))),null!=y&&y.isExpenseCodeRequired&&b&&(null!=f&&f.expenseCode||(U.message.displayable=(0,u.tZ)(a.v,{id:"shared.add_expense_code"}),U.action=P.getAddExpenseCodeAction((null==s?void 0:s.uuid)||"",(null==y?void 0:y.uuid)||""))),h){const e=c(l.find((e=>e.uuid===(null==s?void 0:s.secondaryPaymentProfileUuid))));e?Z.payment.push(e):b&&g&&(U.message.displayable=(0,u.tZ)(a.v,{id:"shared.add_secondary_payment_method"}),U.action=P.getAddSecondaryPaymentMethodAction((null==s?void 0:s.uuid)||"",(null==y?void 0:y.uuid)||""))}var M,L,O;if(y){if((null===(M=s.managedBusinessProfileAttributes)||void 0===M?void 0:M.billingMode)!==i.vO.Decentralized||null!==(L=y.components)&&void 0!==L&&L.periodicCapComponent||null!==(O=y.components)&&void 0!==O&&O.perTripCapComponent){const e=p(y,C,!1);e&&(Z.mealProgram=e)}}else U.message.displayable=(0,u.tZ)(a.v,{id:"shared.select_meal_program"}),U.action=P.getSelectMealProgramAction((null==s?void 0:s.uuid)||"")}(function(e){var s;return(null==e?void 0:e.type)===i.Hu.Personal||(null==e?void 0:e.type)===i.Hu.Business||(null==e?void 0:e.type)===i.Hu.ManagedBusiness&&(null==e||null===(s=e.managedBusinessProfileAttributes)||void 0===s?void 0:s.billingMode)===i.vO.Decentralized})(s)&&(S?Z.payment.push(S):(U.message.displayable=(0,u.tZ)(a.v,{id:"shared.addPaymentMethod"}),U.action=P.getAddPaymentMethodAction((null==s?void 0:s.uuid)||"")))}else E&&x&&null!=B&&B.displayable?(_={text:B.tokenDisplayName||B.displayable.displayName,displayable:null},S&&(Z.payment.push({text:"",displayable:null}),Z.payment.push(S))):t?(_=k,S&&Z.payment.push(S)):_=S||_;return{primary:_,secondary:Z,error:U}}function P(e){const s=((null==e?void 0:e.tokenType)||"unknown").toLowerCase();switch(s){case"google":case"google_pay":return t.Z.google;case"paypal":case"uber_test":case"derivative":case"paytm":case"braintree":case"zaakpay":return function(e){const s=(e||"unknown").toLowerCase();switch(s){case"american_express":case"amex":return t.Z["american express"];default:return t.Z[s]||t.Z.unknown}}(null==e?void 0:e.cardType);case"stored_value":return t.Z.uber;case"apple_pay_display":return t.Z.applepay;default:return t.Z[s]||t.Z.unknown}}function b(e){const s=e.find((e=>"Personal"===e.type));return{profileUuid:(null==s?void 0:s.uuid)||"",paymentProfileUuid:(null==s?void 0:s.defaultPaymentProfileUuid)||""}}function g(e,s){const n=s.find((s=>s.uuid===e));return Boolean(n)}function C(e){const s=e.find((e=>"Personal"!==e.type));return{profileUuid:(null==s?void 0:s.uuid)||"",paymentProfileUuid:(null==s?void 0:s.defaultPaymentProfileUuid)||""}}function h(e,s,n){return{getPaymentSelectAction:function(){return()=>e.push((0,o.vN_)(s,"paymentsSelectProfile"))},getAddPaymentMethodAction:function(n){return()=>e.push((0,o.vN_)(s,"paymentsEdit"))},getSelectMealProgramAction:function(s){return()=>e.push(n(s))},getAddExpenseCodeAction:function(n,a){const i=(0,o.vN_)(s,"businessSelectExpenseCode","".concat(n,"|").concat(a));return()=>e.push(i)},getAddExpenseMemoAction:function(n,a){const i=(0,o.vN_)(s,"businessEnterExpenseMemo","".concat(n,"|").concat(a));return()=>e.push(i)},getAddSecondaryPaymentMethodAction:function(n,a){const i=(0,o.vN_)(s,"paymentsSelectSecondaryPaymentProfile","".concat(n,"|").concat(a));return()=>e.push(i)}}}const x=Object.freeze({mealPlan:"meal_plan",personalBusiness:"personal_business",personalOnly:"personal_only",businessOnly:"business_only",unknown:"unknown"}),B=(e,s,n)=>n?x.businessOnly:e&&s===x.mealPlan?x.mealPlan:e?x.personalBusiness:e?x.unknown:x.personalOnly},72035:(e,s,n)=>{"use strict";n.d(s,{Z:()=>i});var a=n(49608);const i={alipay:(0,a.pZ)(n(66243)),"american express":(0,a.pZ)(n(62130)),applepay:(0,a.pZ)(n(1011)),cash:(0,a.pZ)(n(93345)),cc:(0,a.pZ)(n(25594)),diners:(0,a.pZ)(n(10033)),discover:(0,a.pZ)(n(2641)),google:(0,a.pZ)(n(85458)),india:(0,a.pZ)(n(93345)),jcb:(0,a.pZ)(n(25839)),mastercard:(0,a.pZ)(n(80984)),paypal:(0,a.pZ)(n(8601)),paytm:(0,a.pZ)(n(68259)),uber:(0,a.pZ)(n(30777)),unionpay:(0,a.pZ)(n(42029)),unknown:(0,a.pZ)(n(38388)),ubertest:(0,a.pZ)(n(30777)),venmo:(0,a.pZ)(n(4096)),visa:(0,a.pZ)(n(90319)),upi:(0,a.pZ)(n(14145)),paypay:(0,a.pZ)(n(62178)),derivative:(0,a.pZ)(n(36619)),vouchers:(0,a.pZ)(n(52178)),bancontact:(0,a.pZ)(n(47532))}},70736:(e,s,n)=>{"use strict";n.d(s,{Z:()=>b});var a=n(36151),i=n(17211),t=n(7903),l=n(48643),o=n(49633),u=n(57996);function d(e){const[s,n]=(0,a.useState)(null),{searchBusinessExpenseCodes:i,businessExpenseCodes:t,setBusinessExpenseCodes:l}=function(e){const[s,n]=(0,a.useState)({data:null,error:null,hasLoaded:!1,isLoading:!1}),i=(0,o.Z)("searchBusinessExpenseCodesForUserV1"),t=e=>e?e.trim().toLowerCase():"";return{searchBusinessExpenseCodes:(0,a.useCallback)((a=>{var l,o;let{query:d,resetPageToken:r}=a;n({...s,isLoading:!0});const c=t(d),p=Boolean(s.data&&t(s.data.query)===c);if(p&&r)return void n({...s,isLoading:!1});const y=r?"1":null===(l=s.data)||void 0===l||null===(o=l.paging)||void 0===o?void 0:o.nextPageToken;i({profileUuid:e,pagingInfo:{pageToken:y||"1",limit:25},keyword:c}).then((e=>{var a,i;const t=Number(null===(a=e.paging)||void 0===a?void 0:a.currentPage)>1&&p;n({data:{...e,...t?{expenseCodes:[...(null===(i=s.data)||void 0===i?void 0:i.expenseCodes)||[],...e.expenseCodes||[]]}:null},error:null,hasLoaded:!0,isLoading:!1})})).catch((e=>{e instanceof u.F||n({data:null,error:e,hasLoaded:!0,isLoading:!1})}))}),[s,e,i]),businessExpenseCodes:s,setBusinessExpenseCodes:n}}(e.profileUuid);return(0,a.useEffect)((()=>{!e.profileUuid||!e.policyUuid||null!=t&&t.hasLoaded||t.isLoading||i({query:"",resetPageToken:!0})}),[e.policyUuid,e.profileUuid,t,i]),{businessExpenseCodes:t,searchBusinessExpenseCodes:i,setBusinessExpenseCodes:l,selectedBusinessExpenseCode:s,setSelectedBusinessExpenseCode:n}}var r=n(58980),c=n(72403);var p=n(79026);function y(e){const[s,n]=(0,a.useState)(null),[i,t]=(0,a.useState)(null),{businessPolicies:l,getBusinessPoliciesForUserFromProfile:d,setBusinessPolicies:r}=function(){const e=(0,o.Z)("getBusinessPoliciesForUserV2"),[s,n]=(0,a.useState)({data:null,error:null,hasLoaded:!1,isLoading:!1});return{businessPolicies:s,getBusinessPoliciesForUserFromProfile:(0,a.useCallback)((s=>{e({profileUuid:s}).then((e=>{n({isLoading:!1,hasLoaded:!0,data:e,error:null})})).catch((e=>{e instanceof u.F||n({isLoading:!1,hasLoaded:!0,data:null,error:e})}))}),[e]),setBusinessPolicies:n}}();return(0,a.useEffect)((()=>{!l.isLoading&&!l.hasLoaded&&null!=s&&s.uuid&&s.type===p.Hu.ManagedBusiness&&e.profileUuid&&d(e.profileUuid)}),[e.profileUuid,l,d,s]),{businessPolicies:l,setBusinessPolicies:r,selectedBusinessProfile:s,selectedBusinessPolicy:i,setSelectedBusinessPolicy:t,setSelectedBusinessProfile:n}}var f=n(19474),v=n(92036),m=n(28398),P=n(93026);function b(){var e;const{user:s}=(0,v.Z)(),n=(0,r.TH)(),o=(0,t.k6)(),u=(0,f.ZP)(),b=(0,m.v)((e=>e.checkout)),g=(null==b?void 0:b.selectedBusinessPayment)||null,[C,h]=(0,a.useState)(!1),x=null===(e=s.data)||void 0===e?void 0:e.isLoggedIn,B=(0,P.Z)("getBusinessProfilesV1"),E=(0,i.useQuery)("getBusinessProfilesV1",(()=>B.request("getBusinessProfilesV1",null)),{enabled:x}),{params:_,isOnPolicyRoute:Z,isOnSecondaryPaymentRoute:U,isOnExpenseCodeRoute:S,isOnExpenseMemoRoute:k,isOnStartGroupOrder:M}=function(){const e=(0,r.TH)(),{modalContext:s}=(0,c.RAN)(e,["modalContext"]),{modalName:n}=(0,c.RAN)(e,["modalName"]),[a,i]=s.split("|"),l="businessSelectPolicy"===n,o="paymentsSelectSecondaryPaymentProfile"===n,u="businessSelectExpenseCode"===n,d="businessEnterExpenseMemo"===n,p=a&&i?{params:{profileUuid:a,policyUuid:i}}:null,y=l&&a?{params:{profileUuid:a}}:null,f=o?p:null,v=u?p:null,m=d?p:null,P=(0,t.LX)(e.pathname,c.YEU),b=(0,t.LX)(e.pathname,c.gqw),g=Boolean(P)||Boolean(b);return{params:(null==y?void 0:y.params)||(null==f?void 0:f.params)||(null==v?void 0:v.params)||(null==m?void 0:m.params)||(null==P?void 0:P.params)||(null==b?void 0:b.params)||{},isOnPolicyRoute:l,isOnSecondaryPaymentRoute:o,isOnExpenseCodeRoute:u,isOnExpenseMemoRoute:d,isOnStartGroupOrder:g}}(),L=Z||U||S||k,O=_.profileUuid||(null==g?void 0:g.profileUuid)||"";let A=!1,N=!1;(E.data||[]).forEach((e=>{e.type===p.Hu.Personal?N=!0:[p.Hu.Business,p.Hu.ManagedBusiness].includes(e.type)&&(A=!0)}));const{businessPolicies:H,setBusinessPolicies:w,selectedBusinessProfile:T,selectedBusinessPolicy:q,setSelectedBusinessPolicy:R,setSelectedBusinessProfile:D}=y({profileUuid:O}),{businessExpenseCodes:F,searchBusinessExpenseCodes:I,setBusinessExpenseCodes:G,selectedBusinessExpenseCode:V,setSelectedBusinessExpenseCode:z}=d({profileUuid:O,policyUuid:_.policyUuid||""}),[Y,j]=function(e){const[s,n]=(0,a.useState)(null);return[s,n]}(_.policyUuid),{currentStep:W}=function(e){const[s,n]=(0,a.useState)("PROFILE"),{selectedBusinessPayment:i,selectedBusinessProfile:t,selectedBusinessPolicy:l,selectedBusinessExpenseCode:o,selectedBusinessExpenseMemo:u}=e;return(0,a.useEffect)((()=>{t||n("PROFILE"),t&&!l&&n("POLICY"),t&&l&&null!=t&&t.isMealProgramRequired&&(l.isExpenseCodeRequired||n("COMPLETE"),null!=l&&l.isExpenseCodeRequired&&!o&&n("EXPENSE_CODE"),null!=l&&l.isExpenseCodeRequired&&!l.isExpenseMemoRequired&&o&&n("COMPLETE"),null!=l&&l.isExpenseCodeRequired&&o&&null!=l&&l.isExpenseMemoRequired&&n(u?"COMPLETE":"EXPENSE_MEMO")),null!=i&&i.paymentProfileUuid&&(null==t?void 0:t.type)===p.Hu.Business&&n("COMPLETE")}),[i,t,l,o,u]),{currentStep:s}}({selectedBusinessPayment:g,selectedBusinessProfile:T,selectedBusinessPolicy:q,selectedBusinessExpenseCode:V,selectedBusinessExpenseMemo:Y}),X=(0,a.useCallback)((()=>{if(Z)return(0,c.vN_)(n,"paymentsSelectProfile");if(U||S)return H&&H.data&&H.data&&H.data.length>1&&T&&T.uuid?(0,c.vN_)(n,"businessSelectPolicy",T.uuid):(0,c.vN_)(n,"paymentsSelectProfile");if(k){if(q&&T&&T.uuid){const e=q.uuid,s=T.uuid;return(0,c.vN_)(n,"businessSelectExpenseCode","".concat(s,"|").concat(e))}return(0,c.vN_)(n,"paymentsSelectProfile")}return(0,c.C45)(n)}),[H,S,k,U,Z,n,q,T]),K=(0,a.useCallback)((e=>"group_order"===e?(0,c.Ljk)(n,(0,c.WxO)(_)):(0,c.C45)(n)),[n,_]),Q=(0,a.useCallback)((()=>{D(null),j(null),z(null),R(null),w({isLoading:!1,hasLoaded:!1,data:null,error:null}),G({isLoading:!1,hasLoaded:!1,data:null,error:null})}),[G,w,z,j,R,D]),$=(0,a.useCallback)(((e,s)=>{Q(),u("eats:business_switch_profile_type",{businessDetails:{parentFlow:s||"checkout"}});const a=(E.data||[]).find((s=>s.uuid===e));if(!E.data||!a)return o.replace(K(s));if(D(a),!a.isManagedBusiness)return o.replace(K(s));const i="group_order"===s?(0,c.$m7)(n,(0,c.WxO)(_),e):(0,c.vN_)(n,"businessSelectPolicy",e);return o.replace(i)}),[K,E.data,o,n,Q,D,_,u]),J=(0,a.useCallback)((()=>T?{profileUUID:null==T?void 0:T.uuid,profileType:null==T?void 0:T.type,policyUUID:null==q?void 0:q.uuid,policyVersion:null==q?void 0:q.version,expenseCode:null==V?void 0:V.expenseCode,expenseMemo:Y}:{policyUUID:null,profileUUID:null,policyVersion:null,profileType:p.Hu.Personal,expenseCode:null,expenseMemo:null}),[T,q,V,Y]);return(0,a.useEffect)((()=>{var e;_.profileUuid&&_.profileUuid!==(null==T?void 0:T.uuid)&&$(_.profileUuid),(Z||M)&&null!=H&&H.hasLoaded&&(null==T?void 0:T.uuid)===_.profileUuid&&1===(null==H||null===(e=H.data)||void 0===e?void 0:e.length)&&R(((null==H?void 0:H.data)||[])[0])}),[H,E,o,Z,n,$,_,T,w,R,M]),(0,a.useEffect)((()=>{if(!L&&!T&&E.data&&g&&g.profileUuid&&g.profileUuid!==(null==T?void 0:T.uuid)){const e=(0,l.b6)(E.data,g.profileUuid);D(e)}if(!L&&H.data&&g&&g.policyUuid&&g.policyUuid!==(null==q?void 0:q.uuid)){const e=((null==H?void 0:H.data)||[]).find((e=>e.uuid===g.policyUuid));R(e)}}),[L,g,E.data,D,T,H,R,q]),{businessPolicies:H,businessProfiles:E,getBusinessProfiles:E.refetch,onSelectBusinessProfile:$,setSelectedBusinessProfile:D,hasBusinessProfile:A,isOrgManagedUser:!N&&A,selectedBusinessProfile:T,selectedBusinessPolicy:q,setSelectedBusinessPolicy:R,businessExpenseCodes:F,searchBusinessExpenseCodes:I,selectedBusinessExpenseCode:V,setSelectedBusinessExpenseCode:z,selectedBusinessExpenseMemo:Y,setSelectedBusinessExpenseMemo:j,requiresProfileFlow:e=>{if(!E.data||!e)return!1;const s=E.data.find((s=>s.uuid===e));return(null==s?void 0:s.type)===p.Hu.ManagedBusiness||(null==s?void 0:s.type)===p.Hu.Business},getBackUrl:X,handleBusinessBackButton:()=>{j(null),z(null),I({query:"",resetPageToken:!0}),(S||Z||U)&&R(null),o.replace(X())},currentStep:W,confirmedProfileSelected:C,setConfirmedProfileSelected:h,getInitialUrl:K,getBusinessDetails:J}}},78012:(e,s,n)=>{"use strict";function a(e){var s;const n=e.findIndex((e=>"flexCardInfo"in e)),a=e.filter(((e,s)=>!!e&&s!==n));return{healthcareBenefitsPaymentProfile:null!==(s=e[n])&&void 0!==s?s:void 0,nonHealthcareBenefitsPaymentProfiles:a}}n.d(s,{r:()=>a})},97117:(e,s,n)=>{"use strict";n.d(s,{Z:()=>b});var a=n(36151),i=n(11183),t=n(28398),l=n(92036),o=n(19474),u=n(10185),d=n(2429),r=n(4964);function c(e){let{cartCurrencyCode:s,storeCurrencyCode:n}=e;return Boolean(s&&n&&s!==n)}var p=n(8070),y=n(79026),f=n(43397),v=n(86026),m=n(27694),P=n(78012);function b(e){var s;let{businessProfiles:n,draftOrder:b}=e;const g=(0,i.I0)();let C=!1;const h=(0,o.ZP)(),{user:x}=(0,l.Z)(),{creditBalances:B}=function(){var e,s,n,i,t,p,y;const{serverCart:f}=(0,u.Z)(),{store:v}=(0,d.Z)(null===(e=f.data)||void 0===e?void 0:e.storeUuid),m=(0,o.ZP)(),{user:P}=(0,l.Z)(),b=null===(s=P.data)||void 0===s?void 0:s.isLoggedIn,g=null===(n=f.data)||void 0===n?void 0:n.cartUuid,C=(null===(i=f.data)||void 0===i?void 0:i.currencyCode)||"",h=null===(t=v.data)||void 0===t?void 0:t.uuid,x=(null===(p=v.data)||void 0===p?void 0:p.currencyCode)||"";(0,a.useEffect)((()=>{c({cartCurrencyCode:C,storeCurrencyCode:x})?m("eats:cart__currency_code__mismatch",{cartCurrencyCodeMismatch:{detectionSource:"useGetCreditBalancesHook",cartInfo:{cartUuid:g,currencyCode:C},storeInfo:{storeUuid:h,currencyCode:x}}}):C&&x&&m("eats:cart__currency_code__match",{cartCurrencyCodeMismatch:{detectionSource:"useGetCreditBalancesHook",cartInfo:{cartUuid:g,currencyCode:C},storeInfo:{storeUuid:h,currencyCode:x}}})}),[g,h,C,x,m]);let B=C;c({cartCurrencyCode:C,storeCurrencyCode:x})&&(B=x);const E=(0,r.b)({currencyCode:B},{queryObserverOptions:{enabled:Boolean(B)&&b}});return{isLoading:E.isLoading,isError:E.isError,getCreditBalances:E.refetch,creditBalances:(null===(y=E.data)||void 0===y?void 0:y.creditBalances)||[]}}(),E=(0,t.v)((e=>e.checkout)),{useCredits:_,extraPaymentData:Z,selectedPersonalPayment:U}=E||{},[S,k]=(0,a.useState)(null),[M,L]=(0,a.useState)(null),{shouldUsePaymentsHub:O,paymentsHubProfiles:A,publishableKey:N,integrationName:H,preferredProfileUUID:w}=(0,v.Z)(),{lastSelectedProfile:T,paymentProfiles:q}=(null===(s=x.data)||void 0===s?void 0:s.paymentProfiles)||{lastSelectedProfile:"",paymentProfiles:[]},R=O&&A?A:q,D=(0,a.useCallback)((e=>{const s=(0,m.m)(n.data,e);return s||(R&&e?R.find((s=>s.uuid===e)):null)}),[R,n]),{healthcareBenefitsPaymentProfile:F}=(0,P.r)(R);F&&b&&Array.isArray(b.extraPaymentProfiles)&&(C=Boolean(b.extraPaymentProfiles.find((e=>e.paymentProfileUUID===F.uuid))));const I=(0,f.Z)(),G=D(null==U?void 0:U.uuid),V=(n.data||[]).find((e=>e.defaultPaymentProfileUuid===(null==U?void 0:U.uuid))),z=D(w),Y=D(T),j=(null==G?void 0:G.uuid)||(null==z?void 0:z.uuid)||(null==Y?void 0:Y.uuid),W=(n.data||[]).find((e=>e.type===y.Hu.Personal)),X=D(null==W?void 0:W.defaultPaymentProfileUuid),K=(0,a.useCallback)((e=>{const s=D(e);s&&g((0,p.yG)({uuid:s.uuid}))}),[g,D]);return(0,a.useEffect)((()=>{T.length>0&&!R.includes(T)&&h("eats:payment_hub_last_profile_uuid_miss",{lastProfileUuid:T,webPayments:{key:N,integrationName:H}})}),[h,H,T,R,N]),(0,a.useEffect)((()=>{if(I){const e=R.find((e=>"paypay"===(null==e?void 0:e.tokenType)));null!=e&&e.uuid&&(null==U?void 0:U.uuid)!==(null==e?void 0:e.uuid)&&g((0,p.yG)({uuid:null==e?void 0:e.uuid}))}else G||V||!U?null!=U&&U.uuid||!(j||null!=X&&X.uuid||R.length>0)||g((0,p.yG)({uuid:(null==G?void 0:G.uuid)||(null==z?void 0:z.uuid)||(null==Y?void 0:Y.uuid)||(null==X?void 0:X.uuid)||R[0].uuid})):g((0,p.yG)(null))}),[g,Y,z,U,G,j,I,D,X,R,V,F]),{selectedPersonalPayment:G||z||Y,updateSelectedPersonalPayment:K,guestPaymentProfile:S,setGuestPaymentProfile:k,guestPaymentProfileV2:M,setGuestPaymentProfileV2:L,extraPaymentData:Z,paymentProfiles:R,creditBalances:B,useCredits:_,useHealthcareBenefits:C,healthcareBenefitsPaymentProfile:F}}},4964:(e,s,n)=>{"use strict";n.d(s,{b:()=>l});var a=n(17211),i=n(92614),t=n(93026);function l(e,s){const n=(0,t.Z)("getCreditBalancesV1"),l=(0,i.H)("getCreditBalancesV1",e);return(0,a.useQuery)({queryKey:l,queryFn:e=>{let{queryKey:s}=e;return n.request("getCreditBalancesV1",s[1])},...null==s?void 0:s.queryObserverOptions})}},10185:(e,s,n)=>{"use strict";n.d(s,{Z:()=>u});var a=n(58793),i=n(20034),t=n(14453),l=n(56312),o=n(49535);const u=e=>{const s=(0,i.Z)(),n=(0,a.Ah)(s),u=(0,l.Z)(e).cart,d=(0,o.Z)(n);return{serverCart:u,cartData:u.data||t.g0,hasCartToLoad:Boolean(n),hasCartChanged:d!==n}}},79026:(e,s,n)=>{"use strict";n.d(s,{$C:()=>o,Hu:()=>t,TW:()=>i,vO:()=>l});var a=n(80148);const i={...a.E,data:[]},t={Personal:"Personal",Business:"Business",ManagedBusiness:"ManagedBusiness",ManagedFamily:"ManagedFamily",Commuter:"Commuter"},l={Centralized:"Centralized",Decentralized:"Decentralized"},o=(a.E,{...a.E,data:{expenseCodes:[],hasMore:!1,query:""}})},27694:(e,s,n)=>{"use strict";n.d(s,{S:()=>i,m:()=>t});var a=n(79026);const i=Object.freeze({personal:"personal",business:"business"}),t=(e,s)=>(e||[]).find((e=>e.defaultPaymentProfileUuid===s&&e.type===a.Hu.ManagedFamily))},47532:(e,s,n)=>{e.exports=n.p+"f93f7c0e3996c021.svg"},93345:(e,s,n)=>{e.exports=n.p+"37053d4d3972ae6d.svg"},62130:(e,s,n)=>{e.exports=n.p+"472475c485d211d4.svg"},10033:(e,s,n)=>{e.exports=n.p+"4dbcffc65086d2a1.svg"},2641:(e,s,n)=>{e.exports=n.p+"298c5d3f9e2f0415.svg"},25839:(e,s,n)=>{e.exports=n.p+"4a8c2b5a0ef3d828.svg"},80984:(e,s,n)=>{e.exports=n.p+"85573f825c72de21.svg"},30777:(e,s,n)=>{e.exports=n.p+"16de2f01b2abfcd4.svg"},90319:(e,s,n)=>{e.exports=n.p+"c57afa92c9773650.svg"},25594:(e,s,n)=>{e.exports=n.p+"a90ee32180aec8e4.svg"},36619:(e,s,n)=>{e.exports=n.p+"0b243493e38d216d.svg"},66243:(e,s,n)=>{e.exports=n.p+"7d599df78947c601.svg"},1011:(e,s,n)=>{e.exports=n.p+"a01e1bb4a6328427.svg"},85458:(e,s,n)=>{e.exports=n.p+"6b22c989b1553e5e.svg"},8601:(e,s,n)=>{e.exports=n.p+"29c3a6a2d4cd40fa.svg"},62178:(e,s,n)=>{e.exports=n.p+"ace8b254555025fb.svg"},68259:(e,s,n)=>{e.exports=n.p+"807d3e39daf4977c.svg"},42029:(e,s,n)=>{e.exports=n.p+"82144546657e40d2.svg"},38388:(e,s,n)=>{e.exports=n.p+"155e5c4d6a0dd96b.svg"},14145:(e,s,n)=>{e.exports=n.p+"bd8dd7999964321d.svg"},4096:(e,s,n)=>{e.exports=n.p+"7bcefd4dbe11d684.svg"},52178:(e,s,n)=>{e.exports=n.p+"899713dd6dea5932.svg"}}]);