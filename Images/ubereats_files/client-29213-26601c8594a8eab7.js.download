"use strict";(self.webpackChunkFusion=self.webpackChunkFusion||[]).push([[29213],{79670:(t,i,n)=>{n.d(i,{Nk:()=>u,RO:()=>d,US:()=>s,Xr:()=>r,_k:()=>m,aV:()=>o,nB:()=>l,ob:()=>a});var e=n(44859);const o=160,u=200,r=160,a=200,l=5,d=4,s=1280,m=(0,e.Z)({buyXGetYItemPromotion:null,volumeDiscountPromotion:null})},29213:(t,i,n)=>{n.d(i,{TX:()=>C,ZP:()=>S});var e=n(36151),o=n(81120),u=n(26908),r=n(84586),a=n(28817),l=n(31808),d=n(23773),s=n(21954),m=n(19198),c=n(14760),p=n(81584),v=n(51630),y=n(84684);const f=(t,i)=>{var n;const e=(0,d.T)(),o=(0,v.Z)(),{currentUserCartItems:u,draftOrderUuid:r,isDraftOrderParticipant:a}=(0,s.Z)(),{groupOrder:f,getGroupOrder:I,shouldGetGroupOrder:O}=(0,m.Z)(r),{hasGroupOrderForStore:M}=(0,l.Z)(t||"");(0,c.Z)((()=>O?I():null),[O,I],"use-draft-order-spending-limit-validation");const L=(0,p.DR)(u)+i,P=null===(n=f.data)||void 0===n?void 0:n.spendingLimitAmount,E=null==P?void 0:P.currencyCode;if(!P||!E)return null;const D=P.amount;return M&&a&&L>D?e("go.spending_limit_exceeded",{spendingLimit:(0,y.xG)(o,E,D)}):null};var I=n(97174),O=n(15075),M=n(10086),L=n(7630),P=n(79670);function E(t){return t.map(((t,i)=>{const n=function(t){return t.map((t=>({price:t.price||0,quantity:t.quantity,title:t.title||"",uuid:t.uuid||"",defaultQuantity:t.defaultQuantity||0,childCustomizationList:E(t.customizationV2List||[])})))}((t.childOptions||{}).options||[]);return{uuid:t.uuid,title:t.title||"",childOptions:{options:n},groupId:i}}))}const D=(t,i)=>{const n=null==t?void 0:t.data;return n?(0,u.h7)(n.customizationsList,Object.keys(Q(t,i))):""},Q=(t,i)=>{var n;const e=null==t?void 0:t.data;if(!e)return{};const o=(0,u.qH)(i,(null==t||null===(n=t.data)||void 0===n?void 0:n.customizationsList)||[])||{};return(0,u.xe)(e.customizationsList,o)};let C=function(t){return t.increment="INCREMENT",t.decrement="DECREMENT",t.set="SET",t}({});const S=t=>{var i,n,d,s,m,c,p,v,y,S,h,x;let{store:z,menuItem:b,initialQuantity:g,initialDecimalQuantity:_,initialCustomizations:A,initialSpecialInstructions:U}=t;const T=b.data?(0,L.L5)(b.data):null,k=(null==T?void 0:T.defaultDecimal)||(null==T?void 0:T.minPermitted),B=(null==T?void 0:T.increment)||(0,M.J2)(1,0),G=(null==T?void 0:T.minPermitted)||(0,M.J2)(1,(null==B?void 0:B.exponent)||0),Z=(0,O.Z)({item:b.data,storeUuid:null===(i=z.data)||void 0===i?void 0:i.uuid,counterAdjustment:g}),q=(t=>{let{initialQuantity:i,initialDecimalQuantity:n,quantityIncrement:e,defaultQuantity:o}=t;return n?n.toBaseDecimal():i?(0,M.J2)(i,e.exponent):o||(0,M.J2)(1,e.exponent)})({initialQuantity:g,initialDecimalQuantity:_,defaultQuantity:k,quantityIncrement:B}),F=(null==z||null===(n=z.data)||void 0===n?void 0:n.uuid)||"",{isDraftOrderParticipantForStore:R,canEditGroupOrderCart:w}=(0,l.Z)(F),{serverCart:J}=(0,I.iQ)(),[V,X]=(0,e.useState)(q),[Y,N]=(0,e.useState)(!1),[W,j]=(0,e.useState)(!1),{isItemInPromotion:H,initialItemQuantity:$}=(t=>{const{itemPromotionV2:i}=t||{},n={isItemInPromotion:!1,initialItemQuantity:1};if(!t)return n;const{promotionData:e}=i||{};if(null==e||!e.type)return n;switch(e.type){case P._k.buyXGetYItemPromotion:{const{buyQuantity:t,getQuantity:i}=e;return{isItemInPromotion:!0,initialItemQuantity:1===t&&1===i?2:1}}case P._k.volumeDiscountPromotion:{const{buyQuantity:t}=e;return{isItemInPromotion:!0,initialItemQuantity:t}}default:return n}})(b.data),K=(0,e.useMemo)((()=>{var t;return(null==b||null===(t=b.data)||void 0===t?void 0:t.customizationsList)||[]}),[null==b||null===(d=b.data)||void 0===d?void 0:d.customizationsList]),tt=(0,e.useMemo)((()=>{var t;return(null==b||null===(t=b.data)||void 0===t?void 0:t.previousOrderItemsMap)||{}}),[null==b||null===(s=b.data)||void 0===s?void 0:s.previousOrderItemsMap]),it=M.Tf.from(V||1).toFloat();(0,e.useEffect)((()=>{"number"!=typeof(null==B?void 0:B.exponent)||V.exponent===B.exponent||V===k||_||X((0,M.J2)(it,B.exponent))}),[V,k,it,V.exponent,B.exponent,_]),(0,e.useEffect)((()=>{"number"!=typeof(null==k?void 0:k.exponent)||V.exponent===k.exponent||W||(j(!0),X("number"==typeof k?(0,M.J2)(k,0):k))}),[W,k,V.exponent]),(0,e.useEffect)((()=>{!H||Y||g||(N(!0),X({base:$,exponent:0}))}),[b,Y,g,$,H]);const[nt,et]=(0,e.useState)(U||""),[ot,ut]=(0,e.useState)(A||{});(0,e.useEffect)((()=>{var t;const{customizations:i,specialInstructions:n}=(t=>{let{itemUuid:i,menuItemCustomizationList:n,initialCustomizations:e,previousOrderItemsMap:o}=t;if(!i||!n)return null;if(e)return{customizations:(0,u.iY)(e||{},n)};if(o){var r,a;const t=null===(r=o[i])||void 0===r||null===(a=r[0])||void 0===a?void 0:a.item;if(!t)return null;const e=(null==t?void 0:t.customizationV2s)||[],l=null==t?void 0:t.specialInstructions,d=(0,u.up)(E(e));return{customizations:(0,u.iY)(d,n),...l?{specialInstructions:l}:null}}return null})({itemUuid:null===(t=b.data)||void 0===t?void 0:t.uuid,menuItemCustomizationList:K,initialCustomizations:A,previousOrderItemsMap:tt})||{};i&&ut(i),n&&et(n)}),[K,A,tt,null===(m=b.data)||void 0===m?void 0:m.uuid]);const[rt,at]=(0,e.useReducer)(r.L,r.E);const lt=(0,e.useCallback)((t=>et(t)),[]),dt=(null==b||null===(c=b.data)||void 0===c?void 0:c.sectionUuid)||"",{isOnSale:st}=((null==z||null===(p=z.data)||void 0===p?void 0:p.sections)||[]).find((t=>t.uuid===dt))||{},mt=Boolean(null==z||null===(v=z.data)||void 0===v?void 0:v.isOpen),ct=(0,a.Z)(),pt=Boolean(null==z||null===(y=z.data)||void 0===y?void 0:y.isWithinDeliveryRange),vt=((null==b||null===(S=b.data)||void 0===S?void 0:S.suspendUntil)||0)>0,yt=Boolean(null==z||null===(h=z.data)||void 0===h?void 0:h.isPreview),ft="geolocation_api"!==(null==ct?void 0:ct.originType),It=yt||st&&!vt&&(R||mt&&Boolean(ct)&&ft&&pt),Ot=((t,i,n,e)=>{var r,a;const l=(null==t||null===(r=t.data)||void 0===r?void 0:r.price)||0,d=(0,u.qH)(i,(null==t||null===(a=t.data)||void 0===a?void 0:a.customizationsList)||[])||{};return(0,o.uT)(n,l,d,e.itemsArray,e.itemMap)})(b,ot,it,rt),Mt=f(F,Ot),Lt=(t=>{var i,n,e,o;return"eats.exceed_spending_limit.error"===(null==t||null===(i=t.error)||void 0===i||null===(n=i.meta)||void 0===n?void 0:n.code)&&null!=t&&null!==(e=t.error)&&void 0!==e&&e.message?null==t||null===(o=t.error)||void 0===o?void 0:o.message:null})(J),Pt=Mt||Lt,Et=null!==(x=((t,i,n,e)=>{var r,a;const l=(null==t||null===(r=t.data)||void 0===r?void 0:r.price)||0,d=(0,u.qH)(i,(null==t||null===(a=t.data)||void 0===a?void 0:a.customizationsList)||[])||{},{itemPromotionV2:s}=(null==t?void 0:t.data)||{},{promotionData:m}=s||{},c=n;let p=0;if(null==m||!m.type)return null;switch(m.type){case P._k.buyXGetYItemPromotion:{const{buyQuantity:t,getQuantity:i,maxRedemptionCount:n}=m,u=t+i;if(t>0&&i>0&&c>=u){const t=Math.floor(c/u);p=c-i*Math.min(n,t)}return(0,o.W$)(p,l,d,e.itemsArray,e.itemMap)}case P._k.volumeDiscountPromotion:{const{buyQuantity:t,discountAmount:i,maxRedemptionCount:n}=m;if(t>0&&c>=t){const i=Math.floor(c/t);p=Math.min(n,i)}return(0,o.W$)(p,l,d,e.itemsArray,e.itemMap,i,c)}default:return null}})(b,ot,it,rt))&&void 0!==x?x:0;return{quantity:it,updateQuantity:function(t,i){const n=t===C.set&&null!=i?M.Tf.from(i):M.Tf.from(B).multiply(t===C.increment?1:-1).add(V);(0,M.Xm)(n,G)&&(t===C.decrement||Z({increment:M.Tf.from(n).toFloat(),showSnackbarWarning:!0})!==O.y.ABOVE_LIMIT)&&X(n.toBaseDecimal())},decimalQuantity:V,specialInstructions:nt,updateSpecialInstructions:lt,updateCustomizations:t=>ut(t),selectedCustomizations:ot,itemsUpsell:rt,updateUpsellItemQuantity:(t,i)=>{at(i>0?{type:"ADD_ITEM_UPSELL",payload:{item:t}}:{type:"SUB_ITEM_UPSELL",payload:{item:t}})},hasErrors:Object.keys(Q(b,ot)).length>0,isOnSale:It,totalPrice:Ot,spendingLimitError:Pt,canEditGroupOrderCart:w,firstIncompleteGroup:D(b,ot),discountedPrice:Et}}},31808:(t,i,n)=>{n.d(i,{Z:()=>l});var e=n(28398),o=n(20034),u=n(58793),r=n(21954),a=n(56312);const l=t=>{var i,n;const l=(0,e.v)((t=>t.draftOrder)),d=(0,o.Z)(),s=(0,u.Ah)(d)||"",m=(0,a.Z)(),c=Boolean(null===(i=l.draftOrder.data)||void 0===i?void 0:i.draftOrder.addParticipantsIntended),{isDraftOrderCartLocked:p,isDraftOrderCreator:v,isDraftOrderParticipant:y,draftOrder:f}=(0,r.Z)(),I=Boolean(s)&&c&&(null===(n=m.cart.data)||void 0===n?void 0:n.storeUuid)===t,O=v||!(I&&p),M=y&&I;return{isBundled:Boolean(null==f?void 0:f.bundleGroupInfo),hasGroupOrderForStore:I,canEditGroupOrderCart:O,isDraftOrderParticipantForStore:M}}},84586:(t,i,n)=>{n.d(i,{E:()=>e,L:()=>o});const e={itemMap:{},itemsArray:[]};function o(t,i){if("ADD_ITEM_UPSELL"===i.type){const n=i.payload.item,{itemMap:e,itemsArray:o}=t;return e[n.uuid]?{itemMap:{...e,[n.uuid]:e[n.uuid]+1},itemsArray:o}:{itemMap:{...e,[n.uuid]:1},itemsArray:[...o,n]}}if("SUB_ITEM_UPSELL"===i.type){const n=i.payload.item,{itemMap:e,itemsArray:o}=t;if(e[n.uuid]){if(e[n.uuid]>1)return{itemMap:{...e,[n.uuid]:e[n.uuid]-1},itemsArray:o};const t=o.findIndex((t=>t.uuid===n.uuid)),i={...e},u=[...o];return delete i[n.uuid],u.splice(t,1),{itemMap:i,itemsArray:u}}return{itemMap:e,itemsArray:o}}return t}}}]);